# The test environment and commands
[tox]
envlist = check, test
skipsdist = True

[testenv:check]
description = Runs all formatting tools then static analysis (quick)
deps =
    flake8
    flake8-bandit
    flake8-bugbear
    flake8-builtins
    flake8-comprehensions
    mypy
    # pep8-naming
    shed
whitelist_externals = bash
commands =
    shed
    flake8
    mypy --config-file=tox.ini greenery

[testenv:test]
description = Runs pytest with posargs - `tox -e test -- -v` == `pytest -v`
deps =
    pytest
    pytest-cov
    pytest-xdist
commands =
    pip install --no-deps --editable .
    pytest {posargs}

[testenv:mutmut]
description = Run the mutation testing tool `mutmut` (allow several hours)
deps =
    mutmut
    tox
commands =
    mutmut run
    mutmut results


# Settings for other tools
[mutmut]
paths_to_mutate=greenery
backup=False
runner=tox -e test -- -x -n auto

[pytest]
xfail_strict = True
addopts =
    -Werror
    --tb=short
    --cov=greenery.fsm
    --cov=greenery.lego
    --cov-branch
    --cov-report=term-missing:skip-covered
    --cov-fail-under=97
    # TODO: get tests up to 100% coverage

[coverage:report]
exclude_lines =
    pragma: no cover
    raise NotImplementedError
    raise Exception

[flake8]
ignore =
    E203,E501,W503,S101,S310,   # really do ignore these ones
    B011,A001,A002,A003,S110    # temp ignores to fix later
exclude = .*/,__pycache__

[isort]
known_first_party = greenery
default_section = THIRDPARTY
multi_line_output = 3
include_trailing_comma = True
force_grid_wrap = 0
combine_as_imports = True
line_length = 88

[mypy]
python_version = 3.6
platform = linux
# check_untyped_defs = True
# disallow_untyped_calls = True
# disallow_untyped_defs = True
disallow_untyped_decorators = True
follow_imports = silent
ignore_missing_imports = True
implicit_reexport = False
warn_no_return = True
warn_return_any = True
warn_unreachable = True
warn_unused_ignores = True
warn_unused_configs = True
warn_redundant_casts = True
[mypy-greenery.fsm]
disallow_untyped_calls = True
disallow_untyped_defs = True
